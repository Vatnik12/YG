<!DOCTYPE html>
<html lang="ru" class="scroll-smooth">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>OneScreen План/Факт — by Vatnik</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter','ui-sans-serif','system-ui'] },
          boxShadow:  { soft: '0 10px 30px rgba(0,0,0,.08)' },
          colors: { os:{ primary:'#4f46e5', accent:'#22c55e', warn:'#ef4444' } },
          borderRadius: { 'xl2':'1rem' }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>

  <style>
    :root{ --ring:#e2e8f0 }
    *{ scrollbar-width:thin; scrollbar-color:#CBD5E1 transparent }
    *::-webkit-scrollbar{ width:8px;height:8px } *::-webkit-scrollbar-thumb{ background:#CBD5E1;border-radius:9999px }
    .panel{ border:1px solid var(--ring); border-radius:16px; background:#fff; box-shadow:0 10px 30px rgba(0,0,0,.06) }
    .dark .panel{ background:#0b1220; border-color:#1f2937 }
    .card{ border:1px solid var(--ring); border-radius:16px; background:#fff; box-shadow:0 10px 30px rgba(0,0,0,.06); overflow-wrap: break-word; word-break: break-word; }
    .dark .card{ background:#0b1220; border-color:#1f2937 }
    .pill{ border-radius:999px; padding:2px 8px; font-size:12px; line-height:18px; display:inline-flex; gap:6px; align-items:center; white-space:nowrap; }
    .chip{ border-radius:10px; padding:2px 8px; font-size:12px; line-height:18px; background:#F8FAFC; border:1px solid #E2E8F0; display:inline-flex; gap:6px; align-items:center; white-space:nowrap; }
    .dark .chip{ background:#111827; border-color:#1f2937; color:#cbd5e1 }
    .fade-dim{ filter:saturate(.78) brightness(.92) }
    .drop-hover{ outline:3px dashed #4f46e5; outline-offset:-10px }
    .pill-gray{ background:#eef2f7; color:#334155 } .dark .pill-gray{ background:#0f172a; color:#cbd5e1; border:1px solid #1f2937 }
    .pill-amber{ background:#FEF3C7; color:#92400E } .dark .pill-amber{ background:#78350f; color:#fde68a; border:1px solid #ea580c22 }
    .pill-red{ background:#fee2e2; color:#991b1b } .dark .pill-red{ background:#7f1d1d; color:#fecaca; border:1px solid #ef444422 }
    .pill-teal{ background:#ccfbf1; color:#115e59 } .dark .pill-teal{ background:#064e3b; color:#99f6e4; border:1px solid #14b8a622 }
  </style>
</head>
<body class="min-h-screen flex flex-col font-sans bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100 selection:bg-indigo-200 selection:text-indigo-900">

  <!-- SPLASH (auto-hide 3s + scroll-reveal with unblur) -->
  <div id="splash" class="fixed inset-0 z-50 grid place-items-center bg-[#0b1020] transition-opacity duration-700">
    <div class="relative w-full h-full overflow-hidden">
      <img src="./assets/bg.jpg" alt="" class="absolute inset-0 w-full h-full object-cover opacity-60" loading="eager">
      <div class="absolute inset-0 bg-gradient-to-b from-indigo-900/20 via-slate-900/30 to-slate-900/70"></div>
      <div class="relative h-full w-full flex items-center justify-center">
        <div id="splashContent" class="text-center select-none">
          <div class="inline-flex items-center gap-3 px-5 py-2 rounded-2xl bg-white/10 backdrop-blur ring-1 ring-white/20">
            <span class="text-white/90 font-semibold tracking-wide">OneScreen</span>
          </div>
          <h1 class="mt-5 text-3xl md:text-5xl font-extrabold text-white drop-shadow">План/Факт <span class="text-indigo-200">by Vatnik</span></h1>
          <p class="mt-3 text-white/80">Перетащи xlsx — получи красивый коллаж задач.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- APP WRAPPER: будет размытым, пока висит заставка -->
  <div id="app" class="app-blur">

  <!-- FULL-WIDTH TOOLBAR -->
  <header class="sticky top-0 z-40">
    <div class="backdrop-blur bg-white/80 dark:bg-slate-900/70 border-b border-slate-200 dark:border-slate-800">
      <div class="max-w-[1280px] mx-auto px-4">
        <div class="py-4 md:py-5 flex flex-wrap gap-4 items-center justify-between">
          <div class="flex items-center gap-3 min-w-[200px]">
            <div class="w-10 h-10 rounded-2xl bg-indigo-600 grid place-items-center text-white font-bold">OS</div>
            <div class="leading-tight">
              <div class="font-semibold text-lg">OneScreen: План/Факт</div>
              <div id="modeBadge" class="text-xs text-slate-500 dark:text-slate-400">режим не выбран</div>
            </div>
          </div>

          <div class="flex flex-wrap gap-2">
            <div class="panel px-3 py-2 flex items-center gap-2">
              <span class="text-xs text-slate-500 dark:text-slate-400">Колонки</span>
              <select id="colSelect" class="px-2 py-1 text-sm rounded-lg bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                <option value="2">2</option><option value="3">3</option><option value="4">4</option>
              </select>
            </div>
            <div class="panel px-3 py-2 flex items-center gap-2">
              <span class="text-xs text-slate-500 dark:text-slate-400">Плотность</span>
              <select id="density" class="px-2 py-1 text-sm rounded-lg bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                <option value="md">Стандарт</option><option value="sm">Компактно</option>
              </select>
            </div>
            <div class="panel px-3 py-2 flex items-center gap-2">
              <span class="text-xs text-slate-500 dark:text-slate-400">Сорт</span>
              <select id="sortBy" class="px-2 py-1 text-sm rounded-lg bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                <option value="none">Без сортировки</option>
                <option value="priority">Приоритет</option>
                <option value="deadline">Дедлайн</option>
                <option value="plan">План (ч)</option>
                <option value="fact">Факт (ч)</option>
              </select>
            </div>
            <div class="panel px-3 py-2 flex items-center gap-2">
              <span class="text-xs text-slate-500 dark:text-slate-400">Тема</span>
              <button id="themeToggle" class="px-2 py-1 text-sm rounded-lg bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                <i data-lucide="sun" class="w-4 h-4 hidden dark:inline"></i><i data-lucide="moon" class="w-4 h-4 dark:hidden"></i>
              </button>
            </div>
          </div>

          <div class="flex flex-wrap gap-2">
            <button id="btnExportPNG" disabled class="px-4 py-2 rounded-xl panel disabled:opacity-50">PNG</button>
            <button id="btnExportPDF" disabled class="px-4 py-2 rounded-xl panel disabled:opacity-50">PDF</button>
            <button id="btnCopy" disabled class="px-4 py-2 rounded-xl bg-slate-900 text-white dark:bg-white dark:text-slate-900 disabled:opacity-50">Копировать</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  </div><!-- /#app -->

<script>
  // helpers for blur toggle
  const app=document.getElementById('app');
  function unblurApp(){ app?.classList.add('unblur'); app?.classList.remove('app-blur'); }

  // graceful hide
  function endSplash(){
    const s=document.getElementById('splash');
    if(!s||s.dataset.closed==='1') return;
    s.dataset.closed='1';
    s.style.pointerEvents='none';
    s.classList.add('opacity-0');
    unblurApp();
    setTimeout(()=>{ try{s.remove();}catch(_){} },800);
    window.removeEventListener('scroll',scrollFade);
  }

  // auto hide after 3s with nice gsap
  try{
    const tl=gsap.timeline();
    tl.fromTo('#splashContent',{y:20,opacity:0},{y:0,opacity:1,duration:1.1,ease:'power3.out'})
      .to('#splash',{opacity:0,duration:.9,delay:1.9,ease:'power2.inOut',onComplete:endSplash});
  }catch(_){ setTimeout(endSplash,3000); }
  // fallback hard-timeout 3s
  setTimeout(endSplash,3000);

  // scroll-reveal: gradually fade splash & unblur app based on scrollY
  function scrollFade(){
    const s=document.getElementById('splash');
    if(!s||s.dataset.closed==='1') return;
    const max=300; // пикселей для полного скрытия
    const p=Math.min(1, window.scrollY/max);
    s.style.opacity = String(1-p);
    const blur = (1-p)*7; // от 7px к 0
    app.style.filter = `blur(${blur.toFixed(2)}px)`;
    if(p>=1) endSplash();
  }
  window.addEventListener('scroll', scrollFade, {passive:true});

  // theme toggle (kept from prior code)
  const applyStoredTheme=()=>{const t=localStorage.getItem('theme')||'dark'; document.documentElement.classList.toggle('dark', t==='dark');};
  applyStoredTheme();
  document.getElementById('themeToggle')?.addEventListener('click',()=>{const d=document.documentElement.classList.toggle('dark'); localStorage.setItem('theme', d?'dark':'light');});
</script>
</body>
</html>
